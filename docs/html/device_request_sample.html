<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    
    <title>Device Request Sample</title>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
    <link href="customdoxygen.css" rel="stylesheet" type="text/css" />
    
    <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
    
    <script type="text/javascript" src="utils.js"></script>
  </head>
<body onload="navlink()">
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><a href="index.html"><img alt="Logo" src="logo-idigi.gif"/></a></td>
  
  
  
   
  
  
   
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
   
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">Device Request Sample </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock">
<table><tr>
<td valign="top">
  <div class="navtable" id='navtable' height='100%'>
  <div style='margin: 5px'>
    <ul class='NoBulletNoIndent'>
      <h4>Documentation</h4>
      <li><a href="index.html">Overview</a></li>
      <li><a href="getting_started.html">Getting Started</a></li>
      <li><a href="web_services.html">iDigi Web Services</a></li>

      <h4>API Details</h4>
      <li><a href="api_overview.html">Public API Overview</a></li>
      <li><a href="os_callbacks.html">Operating System</a></li>
      <li><a href="network_callbacks.html">Network</a></li>
      <li><a href="config_callbacks.html">Configuration</a></li>
      <li><a href="data_service.html">Data Service</a></li>
      <li><a href="firmware_download.html">Firmware Download</a></li>
      <li><a href="globals.html">Index</a></li>

      <h4>Samples</h4>
      <li><a href="send_data.html">Send Data</a></li>
      <li><a href="device_request_sample.html">Device Request</a></li>
      <li><a href="fw_download_sample.html">Firmware Download</a></li>

      <h4>More Info</h4>
      <li><a href="../../private/Readme.txt">Release Notes</a></li>
      <li><a href="../../iDigi Integration Kit End-User License Agreement.pdf">License</a></li>

      <h4>Support</h4>
      <li><a href="http://www.digi.com/contactus/email.jsp">Contact Support</a></li>
      <li><a href="http://www.digi.com/support">Support</a></li>
      <li><a href="http://forums.digi.com/support/forum/index">Discussion Forums</a></li>
    </ul>      
   </div>
   </div>
</td>
<td id='maintable' width="100%" valign="top">

<h2><a class="anchor" id="device_request_overview"></a>
Overview</h2>
<p>This sample demonstrates how to process data sent from the iDigi Server. Using the <a class="el" href="data_service.html#data_service_overview">data service api</a> this application prints out the data sent from the iDigi Cloud.</p>
<h2><a class="anchor" id="connect_description"></a>
Code Flow</h2>
<p>The routine main() in the platform directory initializes the IIK and registers the application callback. In the file application.c is the application defined callback idigi_callback(), this routine calls idigi_data_service_callback() when a device request is received.</p>
<p>A User can use the included python script to send a device request to the device.</p>
<p>When the iDigi Cloud sends a device request to the device, idigi_data_service_callback() is called with <a class="el" href="group__idigi__data__service__type__t.html#gga5afb67c78869a035f7497363114ff6d3a3b73d3b3c5b77a44db0e14dbe45fa918">idigi_data_service_type_have_data</a> message type to process the data. This callback is continually called with this message type until the last chunk of data is processed. This sample examines the given target and prints out the device request data. It cancels the device request if the target name is not "myTarget".</p>
<p>After the callback is called with <a class="el" href="group__idigi__data__service__type__t.html#gga5afb67c78869a035f7497363114ff6d3a3b73d3b3c5b77a44db0e14dbe45fa918">idigi_data_service_type_have_data</a> message type for the last chunk of data, the callback is called with <a class="el" href="group__idigi__data__service__type__t.html#gga5afb67c78869a035f7497363114ff6d3a4c6fe42b6a12c510e2648a03468e3d0e">idigi_data_service_type_need_data</a> message type to send response data back to iDigi server. This sample sends and prints out the request and response data.</p>
<p>When the callback is called with <a class="el" href="group__idigi__data__service__type__t.html#gga5afb67c78869a035f7497363114ff6d3a25b587f16c8858b35856d0782980a1dd">idigi_data_service_type_error</a> message type it indicates an error is encountered and needs to cancel the device request. In this example it cancels the request by freeing any memory used.</p>
<h2><a class="anchor" id="connect_build"></a>
Building</h2>
<p>To build this example for a Linux-based platform you can go into the directory public/run/samples/device_request and type make. If you are not running Linux you will need to setup your build system with the information described below and then build the image for your platform.</p>
<h3><a class="anchor" id="source_files"></a>
Source Files</h3>
<p>The following is a list of source files required to build this sample:</p>
 
 <table class="apitable">
 <tr>
 <th class="title">Name</td>
 <th class="title">Description</td>
 <th class="title">Location</td>
 </tr>
 <tr>
 <td>application.c</td>
 <td>Contains application_run() and the application callback</td>
 <td>samples/device_request</td>
 </tr>
 <tr>
 <td>device_request.c</td>
 <td>Rountines used to process the data service device requests</td>
 <td>samples/device_request</td>
 </tr>
 <tr>
 <td>device_request.py</td>
 <td>Python script to send device request</td>
 <td>samples/device_request</td>
 </tr>
 <tr>
 <td>idigi_api.c</td>
 <td>Code for the IIK </td>
 <td>private</td>
 </tr>
 <tr>
 <td>os.c</td>
 <td>Operating system calls</td>
 <td>platforms/<i>my_platform</i></td>
 </tr>
 <tr>
 <td>network.c</td>
 <td> Network interface </td>
 <td>platforms/<i>my_platform</i></td>
 </tr>
 <tr>
 <td>config.c</td>
 <td>Configuration routines</td>
 <td>platforms/<i>my_platform</i></td>
 </tr>
 <tr>
 <td>main.o</td>
 <td>Starting point of program, dependent on build environment</td>
 <td>platforms/<i>my_platform</i></td>
 </tr>
 </table>
 <h3><a class="anchor" id="include_paths"></a>
Include Paths</h3>
<p>The following include paths are required:</p>
<ul>
<li>public/include </li>
<li>run/platforms/linux (substitute with your platform)</li>
</ul>
<h3><a class="anchor" id="defines"></a>
Defines</h3>
<p>The following defines are used in this sample:</p>
<ul>
<li>-DIDIGI_VERSION=0x1010000UL (indicates version 1.1 of the IIK)</li>
</ul>
<h2><a class="anchor" id="python_script"></a>
Python script to retrieve a file from iDigi Device Cloud storage</h2>
<p>This sample provides a simple python script to send a data service device request to developer.idigi.com using  <a href="web_services.html">iDigi Web Services.</a> <p>Run the python script in the sample.</p>
<div class="fragment"><pre class="fragment"> python device_request.py &lt;username&gt; &lt;password&gt; &lt;device_id&gt;
</pre></div><p>Output from this sample:</p>
<div class="fragment"><pre class="fragment"> Device request data: received data = <span class="stringliteral">&quot;My device request data&quot;</span> <span class="keywordflow">for</span> target = <span class="stringliteral">&quot;myTarget&quot;</span>
 Device response data: send response data = My device response data
</pre></div><p>Output from the device_request.py:</p>
<div class="fragment"><pre class="fragment"> Response:
 &lt;sci_reply version=<span class="stringliteral">&quot;1.0&quot;</span>&gt;
    &lt;data_service&gt;
        &lt;device <span class="keywordtype">id</span>=<span class="stringliteral">&quot;00000000-00000000-00000000-00000000&quot;</span>&gt;
            &lt;requests&gt;
               &lt;device_request target_name=<span class="stringliteral">&quot;myTarget&quot;</span> status=<span class="stringliteral">&quot;0&quot;</span>&gt;
               My device response data
               &lt;/device_request&gt;
            &lt;/requests&gt;
        &lt;/device&gt;
    &lt;/data_service&gt;
 &lt;/sci_reply&gt;
</pre></div> </div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer">
<center>
<a href="http://www.idigi.com">
</a> Copyright 1996-2011 Digi International Inc. All rights reserved.
</center>
</address>

</body>
</html>
