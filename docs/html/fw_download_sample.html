<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    
    <title>Firmware Download Sample</title>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
    <link href="customdoxygen.css" rel="stylesheet" type="text/css" />
    
    <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
    
    <script type="text/javascript" src="utils.js"></script>
  </head>
<body onload="navlink()">
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><a href="index.html"><img alt="Logo" src="logo-idigi.gif"/></a></td>
  
  
  
   
  
  
   
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
   
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">Firmware Download Sample </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock">
<table><tr>
<td valign="top">
  <div class="navtable" id='navtable' height='100%'>
  <div style='margin: 5px'>
    <ul class='NoBulletNoIndent'>
      <h4>Documentation</h4>
      <li><a href="index.html">Overview</a></li>
      <li><a href="getting_started.html">Getting Started</a></li>
      <li><a href="web_services.html">iDigi Web Services</a></li>

      <h4>API Details</h4>
      <li><a href="api_overview.html">Public API Overview</a></li>
      <li><a href="os_callbacks.html">Operating System</a></li>
      <li><a href="network_callbacks.html">Network</a></li>
      <li><a href="config_callbacks.html">Configuration</a></li>
      <li><a href="data_service.html">Data Service</a></li>
      <li><a href="firmware_download.html">Firmware Download</a></li>
      <li><a href="globals.html">Index</a></li>

      <h4>Samples</h4>
      <li><a href="send_data.html">Send Data</a></li>
      <li><a href="device_request_sample.html">Device Request</a></li>
      <li><a href="fw_download_sample.html">Firmware Download</a></li>

      <h4>More Info</h4>
      <li><a href="../../private/Readme.txt">Release Notes</a></li>
      <li><a href="../../iDigi Integration Kit End-User License Agreement.pdf">License</a></li>

      <h4>Support</h4>
      <li><a href="http://www.digi.com/contactus/email.jsp">Contact Support</a></li>
      <li><a href="http://www.digi.com/support">Support</a></li>
      <li><a href="http://forums.digi.com/support/forum/index">Discussion Forums</a></li>
    </ul>      
   </div>
   </div>
</td>
<td id='maintable' width="100%" valign="top">

<h2><a class="anchor" id="fw_download_sample_overview"></a>
Overview</h2>
<p>This sample demonstrates how to download firmware to your device using the <a class="el" href="firmware_download.html#fw_overview1">firmware download API</a>. This is a generic sample which does not update the firmware on the device but demonstrates how to use this API.</p>
<h2><a class="anchor" id="connect_description"></a>
Code Flow</h2>
<p>The <a class="el" href="index.html#AppStructure">Public Application Framework</a> <b>Sample</b> section file application.c contains <a class="el" href="group__idigi__callback__t.html">application defined callback idigi_callback()</a>, which traps the <a class="el" href="firmware_download.html#fw_overview1">Firmware Download</a> callbacks. These callbacks are then processed in app_firmware_handler() when a firmware request callback is received.</p>
<p>All interaction with the IIK is through the callback in this sample; Firmware download is initiated fully from the cloud. The file firmware.c contains the routines which process the firmware download callbacks passed to app_firmware_handler().</p>
<p>This sample defines all supported image files with .a and .bin file extensions. The file extension is only validated when updating firmware from iDigi Device Cloud.</p>
<div class="fragment"><pre class="fragment"> <span class="comment">// list of all supported firmware target info</span>
 <span class="keyword">static</span> firmware_list_t firmware_list[] = {
   <span class="comment">// version     code_size     name_spec            description</span>
   {  0x01000000, (<a class="code" href="group__user__types.html#ga06896e8c53f721507066c079052171f8">uint32_t</a>)-1, <span class="stringliteral">&quot;.*\\.a&quot;</span>,            <span class="stringliteral">&quot;Library Image&quot;</span>}, <span class="comment">// any .a image</span>
   {  0x00000100, (<a class="code" href="group__user__types.html#ga06896e8c53f721507066c079052171f8">uint32_t</a>)-1, <span class="stringliteral">&quot;.*\\.[bB][iI][nN]&quot;</span>, <span class="stringliteral">&quot;Binary Image&quot;</span> }  <span class="comment">// any .bin image</span>
 };
</pre></div><p>The routine firmware_download_request() is called when the download is first initiated. It receives information about the download and retuns <a class="el" href="group__idigi__fw__status__t.html#gga48075d1adccfebe70a3b59f34d47cbc4a8775a64ab07216214066adbcc888eac4">idigi_fw_success</a> status indicating that is ready to accept the FW download.</p>
<p>The firmware_image_data() routine is repeatedly called with the image data until the download is complete, the routine firmware_download_complete() is called when the download is complete. At this point the FW can verify that the downloaded image is valid.</p>
<p>When firmware_download_complete() returns <a class="el" href="group__idigi__fw__download__complete__status__t.html#ggaffcec09491fc787f59a32953db5342caafc21319894f6d0d63866ce217917e937">idigi_fw_download_success</a> status, it indicates the firmware image has been updated. iDigi Device Cloud will reset the unit, the routine firmware_reset() is called for resetting.</p>
<p>The routine firmware_download_abort() is called when the iDigi Device Cloud encounters error.</p>
<h2><a class="anchor" id="connect_build"></a>
Building</h2>
<p>To build this example for a Linux-based platform you can go into the directory public/run/samples/firmware_download and type make. If you are not running Linux you will need to setup your build system with the information described below and then build the image for your platform.</p>
<h3><a class="anchor" id="source_files"></a>
Source Files</h3>
<p>The following is a list of source files required to build this sample:</p>
 
 <table class="apitable">
 <tr>
 <th class="title">Name</td>
 <th class="title">Description</td>
 <th class="title">Location</td>
 </tr>
 <tr>
 <th>application.c</th>
 <td>Contains application_run() and the application defined callback</td>
 <td>samples/firmware_download</td>
 </tr>
 <tr>
 <th>firmware.c</th>
 <td>Routines used to process the FW download requests</td>
 <td>samples/firmware_download</td>
 </tr>
 <tr>
 <th>update_firmware.py</th>
 <td>Python script for firmware download</td>
 <td>samples/firmware_download</td>
 </tr>
 <tr>
 <th>query_firmware.py</th>
 <td>Python script for query supported firmware information</td>
 <td>samples/firmware_download</td>
 </tr>
 <tr>
 <th>idigi_api.c</th>
 <td>Code for the IIK </td>
 <td>private</td>
 </tr>
 <tr>
 <th>os.c</th>
 <td>Operating system calls</td>
 <td>platforms/<i>my_platform</i></td>
 </tr>
 <tr>
 <th>network.c</th>
 <td> Network interface </td>
 <td>platforms/<i>my_platform</i></td>
 </tr>
 <tr>
 <th>config.c</th>
 <td>Configuration routines</td>
 <td>platforms/<i>my_platform</i></td>
 </tr>
 <tr>
 <th>main.c</th>
 <td>Starting point of program, dependent on build environment</td>
 <td>platforms/<i>my_platform</i></td>
 </tr>
 </table>
 <h3><a class="anchor" id="include_paths"></a>
Include Paths</h3>
<p>The following include paths are required:</p>
<ul>
<li>public/include </li>
<li>run/platforms/<em>my_platform</em> </li>
</ul>
<h3><a class="anchor" id="defines"></a>
Defines</h3>
<p>The following defines are used in this sample:</p>
<ul>
<li>-DIDIGI_VERSION=0x1010000UL (indicates version 1.1 of the IIK)</li>
</ul>
<h2><a class="anchor" id="running"></a>
Running</h2>
<p>Once successfully built, run the executable, in Linux type ./idigi to run the sample.</p>
<p>Firmware downloads can be initiated by the server using <a href="http://www.idigi.com/idigimanagerpro">iDigi Manager Pro</a> or by issuing a <a class="el" href="web_services.html#services">SCI update_firmware operation</a>.</p>
<h3><a class="anchor" id="fw_gui"></a>
Firmware Download using iDigi Device Cloud GUI</h3>
<p>Login to the iDigi Device cloud at <a href="http://www.idigi.com">http://www.idigi.com</a> and click on your device (described in the <a class="el" href="getting_started.html#idigi_login">Getting Started Section</a>). Once you are logged to see your device, click the Refresh button. The device's status should show as 'Connected'.</p>
<div class="image">
<img src="sample3.png" alt="sample3.png"/>
</div>
<p>Then click the Firmware Update button to update your firmware, and then select the file that is your firmware image on your local machine. The image will then start to upload to your IIK application. The GUI will indicate when it's complete.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>The firmware image name must match the regular expression given to filter names, see <a class="el" href="firmware_download.html#fw_namespec">File Name Spec of Firmware Target</a>.</dd></dl>
<div class="image">
<img src="sample4.png" alt="sample4.png"/>
</div>
<p>The results in this application are displayed in the output console of the application. Since this is only a sample the fiwmware is not updated on the device. The application prints out the target, code size and checksum of the downloaded image.</p>
<h3><a class="anchor" id="fw_python"></a>
Firmware Download using python script</h3>
<p>This sample provides two simple python scripts to update firmware image and query a list of firmware target information using  <a href="web_services.html">iDigi Web Services.</a>  It sends a request to developer.idigi.com.</p>
<p>update_firmware.py opens and sends "image.a" to the device.</p>
<p>To execute update_firmware.py python script:</p>
<div class="fragment"><pre class="fragment"> python update_firmware.py &lt;username&gt; &lt;password&gt; &lt;device_id&gt;
</pre></div><p>Example output from update_firmware.py:</p>
<div class="fragment"><pre class="fragment"> Response:
 &lt;sci_reply version=<span class="stringliteral">&quot;1.0&quot;</span>&gt;
     &lt;update_firmware&gt;
         &lt;device <span class="keywordtype">id</span>=<span class="stringliteral">&quot;00000000-00000000-00000000-00000000&quot;</span>&gt;
         &lt;submitted/&gt;
         &lt;/device&gt;
     &lt;/update_firmware&gt;
 &lt;/sci_reply&gt;
</pre></div><p>To execute query_firmware.py python script:</p>
<div class="fragment"><pre class="fragment"> python query_firmware.py &lt;username&gt; &lt;password&gt; &lt;device_id&gt;
</pre></div><p>An output of query_firmware.py: </p>
<div class="fragment"><pre class="fragment"> Response:
 &lt;sci_reply version=<span class="stringliteral">&quot;1.0&quot;</span>&gt;
    &lt;query_firmware_targets&gt;
    &lt;device <span class="keywordtype">id</span>=<span class="stringliteral">&quot;00000000-00000000-00000000-00000000&quot;</span>&gt;
       &lt;targets&gt;
           &lt;target number=<span class="stringliteral">&quot;0&quot;</span>&gt;
               &lt;name&gt;Library Image&lt;/name&gt;
               &lt;pattern&gt;.*\.a&lt;/pattern&gt;
               &lt;version&gt;1.0.0.0&lt;/version&gt;
               &lt;code_size&gt;4294967295&lt;/code_size&gt;
           &lt;/target&gt;
           &lt;target number=<span class="stringliteral">&quot;1&quot;</span>&gt;
               &lt;name&gt;Binary Image&lt;/name&gt;
               &lt;pattern&gt;.*\.[bB][iI][nN]&lt;/pattern&gt;
               &lt;version&gt;0.0.1.0&lt;/version&gt;
               &lt;code_size&gt;4294967295&lt;/code_size&gt;
           &lt;/target&gt;
         &lt;/targets&gt;
       &lt;/device&gt;
   &lt;/query_firmware_targets&gt;
 &lt;/sci_reply&gt;
</pre></div> </div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer">
<center>
<a href="http://www.idigi.com">
</a> Copyright 1996-2011 Digi International Inc. All rights reserved.
</center>
</address>

</body>
</html>
