<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    
    <title>Network Callbacks</title>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
    <link href="customdoxygen.css" rel="stylesheet" type="text/css" />
    
    <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
    
    <script type="text/javascript" src="utils.js"></script>
  </head>
<body onload="navlink()">
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><a href="index.html"><img alt="Logo" src="logo-idigi.gif"/></a></td>
  
  
  
   
  
  
   
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
   
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">Network Callbacks </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock">
<table><tr>
<td valign="top">
  <div class="navtable" id='navtable' height='100%'>
  <div style='margin: 5px'>
    <ul class='NoBulletNoIndent'>
      <h4>Documentation</h4>
      <li><a href="index.html">Overview</a></li>
      <li><a href="getting_started.html">Getting Started</a></li>
      <li><a href="web_services.html">iDigi Web Services</a></li>

      <h4>API Details</h4>
      <li><a href="api_overview.html">Public API Overview</a></li>
      <li><a href="os_callbacks.html">Operating System</a></li>
      <li><a href="network_callbacks.html">Network</a></li>
      <li><a href="config_callbacks.html">Configuration</a></li>
      <li><a href="data_service.html">Data Service</a></li>
      <li><a href="firmware_download.html">Firmware Download</a></li>
      <li><a href="globals.html">Index</a></li>

      <h4>Samples</h4>
      <li><a href="send_data.html">Send Data</a></li>
      <li><a href="device_request_sample.html">Device Request</a></li>
      <li><a href="fw_download_sample.html">Firmware Download</a></li>

      <h4>More Info</h4>
      <li><a href="../../private/Readme.txt">Release Notes</a></li>
      <li><a href="../../iDigi Integration Kit End-User License Agreement.pdf">License</a></li>

      <h4>Support</h4>
      <li><a href="http://www.digi.com/contactus/email.jsp">Contact Support</a></li>
      <li><a href="http://www.digi.com/support">Support</a></li>
      <li><a href="http://forums.digi.com/support/forum/index">Discussion Forums</a></li>
    </ul>      
   </div>
   </div>
</td>
<td id='maintable' width="100%" valign="top">

<h2><a class="anchor" id="net"></a>
Network Callbacks</h2>
<p>The IIK interfaces to the platform's network interface through the callbacks listed below. These are called through the application callback described in the <a class="el" href="api_overview.html#api1_overview">Public API Overview</a>.</p>
<ol type="1">
<li><a class="el" href="network_callbacks.html#connect">Connect</a></li>
<li><a class="el" href="network_callbacks.html#send">Send</a></li>
<li><a class="el" href="network_callbacks.html#receive">Receive</a></li>
<li><a class="el" href="network_callbacks.html#close">Close</a></li>
<li><a class="el" href="network_callbacks.html#disconnected">Connection disconnected</a></li>
<li><a class="el" href="network_callbacks.html#reboot">Reboot</a></li>
</ol>
<h2><a class="anchor" id="connect"></a>
Connect</h2>
<p>This callback is called to establish connection between IIK and the iDigi Cloud. Callback is responsible to setup any socket options.</p>
<p>This callback is trapped in application.c, in the <b>Sample</b> section of <a class="el" href="index.html#AppStructure">Public Application Framework</a> and implemented in the <b>Platform</b> function <a class="el" href="network_8c.html#a9dc69781c58510962d0bbca3aef8cd86" title="Connect to the iDigi server.">app_network_connect()</a> in <a class="el" href="network_8c.html" title="Rountines which implement the IIK network interface.">network.c</a>.</p>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="network_8c.html#a9dc69781c58510962d0bbca3aef8cd86" title="Connect to the iDigi server.">app_network_connect()</a></dd></dl>
 
 <table class="apitable">
 <tr> <th colspan="2" class="title">Arguments</th> </tr> 
 <tr><th class="subtitle">Name</th> <th class="subtitle">Description</th></tr>
 <tr>
 <th>class_id</th>
 <td> <a class="el" href="group__idigi__class__t.html#gga3d9da89a031dfb425e963b0ae7bfbf33a574cbaa906514d12d8a931d0ca382b51">idigi_class_network</a>  </td>
 </tr>
 <tr>
 <th>request_id</th>
 <td> <a class="el" href="group__idigi__network__request__t.html#gga6772dc9d110c19be6fa789f45828f70eaa531204a3c84ed03a3574f13bd5f7a01">idigi_network_connect</a>  </td>
 </tr>
 <tr>
 <th>request_data</th>
 <td>Pointer to server URL that callback will make connection to on  <a class="el" href="group__idigi__port__numbers.html#gaddef60c4a1894d70b0b04169e498c31a">IDIGI_PORT</a>  for non-secure port number or  <a class="el" href="group__idigi__port__numbers.html#gaf2d7b1d1d2fdc16dbddad8f8a3d3f0c4">IDIGI_SSL_PORT</a>  for secure port number </td>
 </tr>
 <tr>
 <th>request_length</th>
 <td> Length of the server URL.</td>
 </tr>
 <tr>
 <th>response_data</th>
 <td> Callback returns the pointer to   <a class="el" href="group__idigi__network__handle__t.html">Network Handle</a>  which is used throughout network socket callback calls. </td>
 </tr>
 <tr>
 <th>response_length</th>
 <td>Pointer to memory where callback writes the size of idigi_network_handle_t</td>
 </tr>
 <tr> <th colspan="2" class="title">Return Values</th> </tr> 
 <tr><th class="subtitle">Values</th> <th class="subtitle">Description</th></tr>
 <tr>
 <td> <a class="el" href="group__idigi__callback__status__t.html#ggaada37d2b3520ae3522ccf0ed368f458dabda2f93a62bdf6914f7c2f1736b59e94">idigi_callback_continue</a>  </td>
 <td>Callback successfully established a connection</td>
 </tr>
 <tr>
 <td> <a class="el" href="group__idigi__callback__status__t.html#ggaada37d2b3520ae3522ccf0ed368f458da77b6cf49c4a1cb6d18489ec31112d7fa">idigi_callback_abort</a>  </td>
 <td>Callback was unable to connect to the server and callback aborted IIK</td>
 </tr>
 <tr>
 <td> <a class="el" href="group__idigi__callback__status__t.html#ggaada37d2b3520ae3522ccf0ed368f458da7eeb64c92e877a42a8592a8b05a4ade8">idigi_callback_busy</a>  </td>
 <td>Callback is busy connecting and needs to be called back again</td>
 </tr>
 </table>
 <p>Example:</p>
<div class="fragment"><pre class="fragment"> <a class="code" href="group__idigi__callback__status__t.html#gaada37d2b3520ae3522ccf0ed368f458d">idigi_callback_status_t</a> idigi_callback(<a class="code" href="group__idigi__class__t.html#ga3d9da89a031dfb425e963b0ae7bfbf33">idigi_class_t</a> <span class="keyword">const</span> class_id, <a class="code" href="unionidigi__request__t.html">idigi_request_t</a> <span class="keyword">const</span> request_id
                              <span class="keywordtype">void</span> * <span class="keyword">const</span> request_data, <span class="keywordtype">size_t</span> <span class="keyword">const</span> request_length,
                              <span class="keywordtype">void</span> * response_data, <span class="keywordtype">size_t</span> * <span class="keyword">const</span> response_length)
 {

     <span class="keywordflow">if</span> (class_id = <a class="code" href="group__idigi__class__t.html#gga3d9da89a031dfb425e963b0ae7bfbf33a574cbaa906514d12d8a931d0ca382b51">idigi_class_network</a> &amp;&amp; request_id.network_request == <a class="code" href="group__idigi__network__request__t.html#gga6772dc9d110c19be6fa789f45828f70eaa531204a3c84ed03a3574f13bd5f7a01">idigi_network_connect</a>)
     {
         <span class="keyword">static</span> <a class="code" href="group__idigi__network__handle__t.html#ga56cc37674d1d16993665a185cbb3d6ac">idigi_network_handle_t</a> idigi_fd = -1;
         <span class="keyword">struct </span>sockaddr_in sin;
         in_addr_t ip_addr;
         <span class="keywordtype">int</span> opt=1;

        <a class="code" href="group__idigi__network__handle__t.html#ga56cc37674d1d16993665a185cbb3d6ac">idigi_network_handle_t</a> ** network_handle = (<a class="code" href="group__idigi__network__handle__t.html#ga56cc37674d1d16993665a185cbb3d6ac">idigi_network_handle_t</a> **)response_data;

         <span class="keywordflow">if</span> (idigi_fd == -1)
         {
             <span class="keywordflow">if</span> (dns_resolve_name((<span class="keywordtype">char</span> *)request_data, request_length, &amp;ip_addr) != 0)
             {
                 <span class="keywordflow">return</span> <a class="code" href="group__idigi__callback__status__t.html#ggaada37d2b3520ae3522ccf0ed368f458da77b6cf49c4a1cb6d18489ec31112d7fa">idigi_callback_abort</a>;
             }

             idigi_fd = socket(AF_INET, SOCK_STREAM, 0);
             <span class="keywordflow">if</span> (idigi_fd &gt;= 0)
             {
                 <span class="keywordtype">int</span> enabled = 1;

                 <span class="keywordflow">if</span> (setsockopt(idigi_fd, SOL_SOCKET, SO_KEEPALIVE, (<span class="keywordtype">char</span>*)&amp;enabled, <span class="keyword">sizeof</span>(enabled)) &lt; 0)
                {
                    perror(<span class="stringliteral">&quot;setsockopt SO_KEEPALIVE failed&quot;</span>);
                }

                <span class="keywordflow">if</span> (setsockopt(idigi_fd, IPPROTO_TCP, TCP_NODELAY, (<span class="keywordtype">char</span>*)&amp;enabled, <span class="keyword">sizeof</span>(enabled)) &lt; 0)
                {
                    perror(<span class="stringliteral">&quot;setsockopt TCP_NODELAY failed&quot;</span>);
                }
            }
            <span class="keywordflow">else</span>
            {
                perror(<span class="stringliteral">&quot;Could not open socket&quot;</span>);
                <span class="keywordflow">return</span> <a class="code" href="group__idigi__callback__status__t.html#ggaada37d2b3520ae3522ccf0ed368f458da77b6cf49c4a1cb6d18489ec31112d7fa">idigi_callback_abort</a>;
            }

            <span class="comment">/* set non-blocking socket */</span>
            <span class="keywordflow">if</span> (ioctl(idigi_fd, FIONBIO, &amp;opt) &lt; 0)
            {
                perror(<span class="stringliteral">&quot;FIONBIO failed&quot;</span>);
                <span class="keywordflow">return</span> <a class="code" href="group__idigi__callback__status__t.html#ggaada37d2b3520ae3522ccf0ed368f458da77b6cf49c4a1cb6d18489ec31112d7fa">idigi_callback_abort</a>;
            }

            memset((<span class="keywordtype">char</span> *)&amp;sin, 0, <span class="keyword">sizeof</span>(sin));
            memcpy(&amp;sin.sin_addr, &amp;ip_addr, <span class="keyword">sizeof</span> sin.sin_addr);
            sin.sin_port   = htons(<a class="code" href="group__idigi__port__numbers.html#gaddef60c4a1894d70b0b04169e498c31a">IDIGI_PORT</a>);
            sin.sin_family = AF_INET;
            <span class="keywordflow">if</span> (connect(idigi_fd, (<span class="keyword">struct</span> sockaddr *)&amp;sin, <span class="keyword">sizeof</span>(sin)) &lt; 0)
            {
                 perror(<span class="stringliteral">&quot;connect() failed&quot;</span>);
                <span class="keywordflow">return</span> <a class="code" href="group__idigi__callback__status__t.html#ggaada37d2b3520ae3522ccf0ed368f458da77b6cf49c4a1cb6d18489ec31112d7fa">idigi_callback_abort</a>;
            }
        }

        *network_handle = &amp;idigi_fd;
        *response_length = <span class="keyword">sizeof</span> idigi_fd;

     }
     <span class="keywordflow">return</span> <a class="code" href="group__idigi__callback__status__t.html#ggaada37d2b3520ae3522ccf0ed368f458dabda2f93a62bdf6914f7c2f1736b59e94">idigi_callback_continue</a>;
 }
</pre></div><h2><a class="anchor" id="send"></a>
Send</h2>
<p>Callback is called to send data to the iDigi Device Cloud. This function may block up to the timeout specified in the <a class="el" href="structidigi__write__request__t.html">idigi_write_request_t</a>. If it encounters EAGAIN or EWOULDBLOCK error, 0 bytes must be returned and IIK will continue calling this function.</p>
<p>This callback is trapped in application.c, in the <b>Sample</b> section of <a class="el" href="index.html#AppStructure">Public Application Framework</a> and implemented in the <b>Platform</b> function <a class="el" href="network_8c.html#a03322df02ba77acec61357658cb02178" title="Send data to the iDigi server.">app_network_send()</a> in <a class="el" href="network_8c.html" title="Rountines which implement the IIK network interface.">network.c</a>.</p>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="network_8c.html#a03322df02ba77acec61357658cb02178" title="Send data to the iDigi server.">app_network_send()</a></dd></dl>
 
 <table class="apitable">
 <tr> <th colspan="2" class="title">Arguments</th> </tr> 
 <tr><th class="subtitle">Name</th> <th class="subtitle">Description</th></tr>
 <tr>
 <th>class_id</th>
 <td> <a class="el" href="group__idigi__class__t.html#gga3d9da89a031dfb425e963b0ae7bfbf33a574cbaa906514d12d8a931d0ca382b51">idigi_class_network</a>  </td>
 </tr>
 <tr>
 <th>request_id</th>
 <td> <a class="el" href="group__idigi__network__request__t.html#gga6772dc9d110c19be6fa789f45828f70ea0f9101ff9bdd90d613dc1344385a7037">idigi_network_send</a>  </td>
 </tr>
 <tr>
 <th>request_data</th>
 <td>Pointer to  <a class="el" href="structidigi__write__request__t.html">idigi_write_request_t</a>  </td>
 </tr>
 <tr>
 <th>request_length</th>
 <td> Size of  <a class="el" href="structidigi__write__request__t.html">idigi_write_request_t</a>.  </td>
 </tr>
 <tr>
 <th>response_data</th>
 <td> Pointer to size_t type memory where callback writes number of bytes sent to the iDigi server. </td>
 </tr>
 <tr>
 <th>response_length</th>
 <td>N/A</td>
 </tr>
 <tr> <th colspan="2" class="title">Return Values</th> </tr> 
 <tr><th class="subtitle">Values</th> <th class="subtitle">Description</th></tr>
 <tr>
 <td> <a class="el" href="group__idigi__callback__status__t.html#ggaada37d2b3520ae3522ccf0ed368f458dabda2f93a62bdf6914f7c2f1736b59e94">idigi_callback_continue</a>  </td>
 <td>Callback successfully sent data to server</td>
 </tr>
 <tr>
 <td> <a class="el" href="group__idigi__callback__status__t.html#ggaada37d2b3520ae3522ccf0ed368f458da77b6cf49c4a1cb6d18489ec31112d7fa">idigi_callback_abort</a>  </td>
 <td>Callback was unable to send data to server and callback aborts IIK</td>
 </tr>
 <tr>
 <td> <a class="el" href="group__idigi__callback__status__t.html#ggaada37d2b3520ae3522ccf0ed368f458da7eeb64c92e877a42a8592a8b05a4ade8">idigi_callback_busy</a>  </td>
 <td>Callback is busy and needs to be called again to send data</td>
 </tr>
 </table>
 <p>Example:</p>
<div class="fragment"><pre class="fragment"> <a class="code" href="group__idigi__callback__status__t.html#gaada37d2b3520ae3522ccf0ed368f458d">idigi_callback_status_t</a> idigi_callback(<a class="code" href="group__idigi__class__t.html#ga3d9da89a031dfb425e963b0ae7bfbf33">idigi_class_t</a> <span class="keyword">const</span> class_id, <a class="code" href="unionidigi__request__t.html">idigi_request_t</a> <span class="keyword">const</span> request_id
                              <span class="keywordtype">void</span> * <span class="keyword">const</span> request_data, <span class="keywordtype">size_t</span> <span class="keyword">const</span> request_length,
                              <span class="keywordtype">void</span> * response_data, <span class="keywordtype">size_t</span> * <span class="keyword">const</span> response_length)
 {

     <span class="keywordflow">if</span> (class_id = <a class="code" href="group__idigi__class__t.html#gga3d9da89a031dfb425e963b0ae7bfbf33a574cbaa906514d12d8a931d0ca382b51">idigi_class_network</a> &amp;&amp; request_id.network_request == <a class="code" href="group__idigi__network__request__t.html#gga6772dc9d110c19be6fa789f45828f70ea0f9101ff9bdd90d613dc1344385a7037">idigi_network_send</a>)
     {
          <a class="code" href="structidigi__write__request__t.html">idigi_write_request_t</a> <span class="keyword">const</span> * <span class="keyword">const</span> write_data = (<a class="code" href="structidigi__write__request__t.html">idigi_write_request_t</a> *)request_data;
          <span class="keywordtype">size_t</span> * return_bytes_written = (<span class="keywordtype">size_t</span> *)response_data;
          <span class="keywordtype">int</span> bytes_sent;

          bytes_sent = send(*write_data-&gt;<a class="code" href="structidigi__write__request__t.html#a7bcf6bdd9867cbd1c8f3b3d4aff448f5">network_handle</a>, (<span class="keywordtype">char</span> *)write_data-&gt;<a class="code" href="structidigi__write__request__t.html#ac8733c58bc671239139641960e2d5dbf">buffer</a>,
                       write_data-&gt;<a class="code" href="structidigi__write__request__t.html#ae809d5359ac030c60a30a8f0b2294b82">length</a>, 0);
          <span class="keywordflow">if</span> (bytes_sent &lt; 0)
          {
              <span class="keywordflow">if</span> ((errno == EAGAIN) || (errno == EWOULDBLOCK))
              {
                  <span class="keywordflow">return</span> <a class="code" href="group__idigi__callback__status__t.html#ggaada37d2b3520ae3522ccf0ed368f458da7eeb64c92e877a42a8592a8b05a4ade8">idigi_callback_busy</a>;
              }
              <span class="keywordflow">else</span>
              {
                  perror(<span class="stringliteral">&quot;network_send: send() failed&quot;</span>);
                  <span class="keywordflow">return</span> <a class="code" href="group__idigi__callback__status__t.html#ggaada37d2b3520ae3522ccf0ed368f458da77b6cf49c4a1cb6d18489ec31112d7fa">idigi_callback_abort</a>;
              }
          }
          *return_bytes_written = bytes_sent;
          <span class="keywordflow">return</span> <a class="code" href="group__idigi__callback__status__t.html#ggaada37d2b3520ae3522ccf0ed368f458dabda2f93a62bdf6914f7c2f1736b59e94">idigi_callback_continue</a>;
     }
 }
</pre></div><h2><a class="anchor" id="receive"></a>
Receive</h2>
<p>Callback is called to receive a specified number of bytes of data from the iDigi Device Cloud. This function may block up to the timeout specified in the <a class="el" href="structidigi__read__request__t.html">idigi_read_request_t</a>.</p>
<p>This callback is trapped in application.c, in the <b>Sample</b> section of <a class="el" href="index.html#AppStructure">Public Application Framework</a> and implemented in the <b>Platform</b> function <a class="el" href="network_8c.html#a8701f9056628d15ef7af3902b9516443" title="Receive data from the iDigi server.">app_network_receive()</a> in <a class="el" href="network_8c.html" title="Rountines which implement the IIK network interface.">network.c</a>.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>In the multithreaded model (<a class="el" href="group__idigi__run.html#gabdea7b2d88546bccfabe22349dcca773" title="Run the IIK, this function does not return and is used in a multithreaded environment.">idigi_run()</a>) this is the point where the IIK will relinquish control of the CPU.</dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="network_8c.html#a8701f9056628d15ef7af3902b9516443" title="Receive data from the iDigi server.">app_network_receive()</a></dd></dl>
 
 <table class="apitable">
 <tr> <th colspan="2" class="title">Arguments</th> </tr> 
 <tr><th class="subtitle">Name</th> <th class="subtitle">Description</th></tr>
 <tr>
 <th>class_id</th>
 <td> <a class="el" href="group__idigi__class__t.html#gga3d9da89a031dfb425e963b0ae7bfbf33a574cbaa906514d12d8a931d0ca382b51">idigi_class_network</a>  </td>
 </tr>
 <tr>
 <th>request_id</th>
 <td> <a class="el" href="group__idigi__network__request__t.html#gga6772dc9d110c19be6fa789f45828f70ea6f1b6b8fb63d39519cee395a298e6bba">idigi_network_receive</a>  </td>
 </tr>
 <tr>
 <th>request_data</th>
 <td>Pointer to  <a class="el" href="structidigi__read__request__t.html">idigi_read_request_t</a>  </td>
 </tr>
 <tr>
 <th>request_length</th>
 <td> Size of  <a class="el" href="structidigi__read__request__t.html">idigi_read_request_t</a>.  </td>
 </tr>
 <tr>
 <th>response_data</th>
 <td> Pointer to size_t type memory where callback writes number of bytes received from the iDigi server. </td>
 </tr>
 <tr>
 <th>response_length</th>
 <td>N/A</td>
 </tr>
 <tr> <th colspan="2" class="title">Return Values</th> </tr> 
 <tr><th class="subtitle">Values</th> <th class="subtitle">Description</th></tr>
 <tr>
 <td> <a class="el" href="group__idigi__callback__status__t.html#ggaada37d2b3520ae3522ccf0ed368f458dabda2f93a62bdf6914f7c2f1736b59e94">idigi_callback_continue</a>  </td>
 <td>Callback successfully received number of requested bytes</td>
 </tr>
 <tr>
 <td> <a class="el" href="group__idigi__callback__status__t.html#ggaada37d2b3520ae3522ccf0ed368f458da77b6cf49c4a1cb6d18489ec31112d7fa">idigi_callback_abort</a>  </td>
 <td>Callback was unable to receive data from server and callback aborts IIK</td>
 </tr>
 <tr>
 <td> <a class="el" href="group__idigi__callback__status__t.html#ggaada37d2b3520ae3522ccf0ed368f458da7eeb64c92e877a42a8592a8b05a4ade8">idigi_callback_busy</a>  </td>
 <td>Callback is busy and needs to be called again to receive data</td>
 </tr>
 </table>
 <p>Example:</p>
<div class="fragment"><pre class="fragment"> <a class="code" href="group__idigi__callback__status__t.html#gaada37d2b3520ae3522ccf0ed368f458d">idigi_callback_status_t</a> idigi_callback(<a class="code" href="group__idigi__class__t.html#ga3d9da89a031dfb425e963b0ae7bfbf33">idigi_class_t</a> <span class="keyword">const</span> class_id, <a class="code" href="unionidigi__request__t.html">idigi_request_t</a> <span class="keyword">const</span> request_id
                              <span class="keywordtype">void</span> * <span class="keyword">const</span> request_data, <span class="keywordtype">size_t</span> <span class="keyword">const</span> request_length,
                              <span class="keywordtype">void</span> * response_data, <span class="keywordtype">size_t</span> * <span class="keyword">const</span> response_length)
 {

     <span class="keywordflow">if</span> (class_id = <a class="code" href="group__idigi__class__t.html#gga3d9da89a031dfb425e963b0ae7bfbf33a574cbaa906514d12d8a931d0ca382b51">idigi_class_network</a> &amp;&amp; request_id.network_request == <a class="code" href="group__idigi__network__request__t.html#gga6772dc9d110c19be6fa789f45828f70ea6f1b6b8fb63d39519cee395a298e6bba">idigi_network_receive</a>)
     {
           <a class="code" href="structidigi__read__request__t.html">idigi_read_request_t</a> * read_data = (<a class="code" href="structidigi__read__request__t.html">idigi_read_request_t</a> *)request_data;
           <span class="keywordtype">size_t</span> * return_bytes_read = (<span class="keywordtype">size_t</span> *)response_data;
          <span class="keywordtype">int</span> bytes_received;

          bytes_received = recv(*read_data-&gt;<a class="code" href="structidigi__read__request__t.html#a7bcf6bdd9867cbd1c8f3b3d4aff448f5">network_handle</a>, (<span class="keywordtype">char</span> *)read_data-&gt;<a class="code" href="structidigi__read__request__t.html#a56ed84df35de10bdb65e72b184309497">buffer</a>, (<span class="keywordtype">int</span>)read_data-&gt;<a class="code" href="structidigi__read__request__t.html#ae809d5359ac030c60a30a8f0b2294b82">length</a>, 0);
          <span class="keywordflow">if</span> (bytes_received == 0)
          {
              <span class="comment">/* EOF on input: the connection was closed. */</span>
              <span class="keywordflow">return</span> <a class="code" href="group__idigi__callback__status__t.html#ggaada37d2b3520ae3522ccf0ed368f458da77b6cf49c4a1cb6d18489ec31112d7fa">idigi_callback_abort</a>;
          }
          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bytes_received &lt; 0)
          {
              <span class="comment">/* An error of some sort occurred: handle it appropriately. */</span>
              <span class="keywordflow">if</span> (errno == EAGAIN || errno == EWOULDBLOCK)
              {
                  <span class="keywordflow">return</span> <a class="code" href="group__idigi__callback__status__t.html#ggaada37d2b3520ae3522ccf0ed368f458da7eeb64c92e877a42a8592a8b05a4ade8">idigi_callback_busy</a>;
              }
              <span class="keywordflow">else</span>
              {
                  perror(<span class="stringliteral">&quot;network_receive: recv() failed&quot;</span>);
                  <span class="comment">/* if not timeout (no data) return an error */</span>
                  <span class="keywordflow">return</span> <a class="code" href="group__idigi__callback__status__t.html#ggaada37d2b3520ae3522ccf0ed368f458da77b6cf49c4a1cb6d18489ec31112d7fa">idigi_callback_abort</a>;
              }
          }
          *return_bytes_read = (size_t)bytes_received;
          <span class="keywordflow">return</span> <a class="code" href="group__idigi__callback__status__t.html#ggaada37d2b3520ae3522ccf0ed368f458dabda2f93a62bdf6914f7c2f1736b59e94">idigi_callback_continue</a>;
     }
 }
</pre></div><h2><a class="anchor" id="close"></a>
Close</h2>
<p>Callback is called to close a connection between a device and the iDigi Device Cloud</p>
<p>This callback is trapped in application.c, in the <b>Sample</b> section of <a class="el" href="index.html#AppStructure">Public Application Framework</a> and implemented in the <b>Platform</b> function <a class="el" href="network_8c.html#aaae5942657b1cd15f43d223de127ceb7" title="Close the connection to the iDigi server.">app_network_close()</a> in <a class="el" href="network_8c.html" title="Rountines which implement the IIK network interface.">network.c</a>.</p>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="network_8c.html#aaae5942657b1cd15f43d223de127ceb7" title="Close the connection to the iDigi server.">app_network_close()</a></dd></dl>
 
 <table class="apitable">
 <tr> <th colspan="2" class="title">Arguments</th> </tr> 
 <tr><th class="subtitle">Name</th> <th class="subtitle">Description</th></tr>
 <tr>
 <th>class_id</th>
 <td> <a class="el" href="group__idigi__class__t.html#gga3d9da89a031dfb425e963b0ae7bfbf33a574cbaa906514d12d8a931d0ca382b51">idigi_class_network</a>  </td>
 </tr>
 <tr>
 <th>request_id</th>
 <td> <a class="el" href="group__idigi__network__request__t.html#gga6772dc9d110c19be6fa789f45828f70ea6384f605f8659f9755e0e05532706b99">idigi_network_close</a>  </td>
 </tr>
 <tr>
 <th>request_data</th>
 <td>Pointer to  idigi_network_handle_t  </td>
 </tr>
 <tr>
 <th>request_length</th>
 <td> Size of  idigi_network_handle_t.  </td>
 </tr>
 <tr>
 <th>response_data</th>
 <td> N/A </td>
 </tr>
 <tr>
 <th>response_length</th>
 <td>N/A</td>
 </tr>
 <tr> <th colspan="2" class="title">Return Values</th> </tr> 
 <tr><th class="subtitle">Values</th> <th class="subtitle">Description</th></tr>
 <tr>
 <td> <a class="el" href="group__idigi__callback__status__t.html#ggaada37d2b3520ae3522ccf0ed368f458dabda2f93a62bdf6914f7c2f1736b59e94">idigi_callback_continue</a>  </td>
 <td>Callback successfully closed the connection</td>
 </tr>
 <tr>
 <td> <a class="el" href="group__idigi__callback__status__t.html#ggaada37d2b3520ae3522ccf0ed368f458da77b6cf49c4a1cb6d18489ec31112d7fa">idigi_callback_abort</a>  </td>
 <td>Callback was unable to close the connection and callback aborted IIK</td>
 </tr>
 </table>
 <p>Example:</p>
<div class="fragment"><pre class="fragment"> <a class="code" href="group__idigi__callback__status__t.html#gaada37d2b3520ae3522ccf0ed368f458d">idigi_callback_status_t</a> idigi_callback(<a class="code" href="group__idigi__class__t.html#ga3d9da89a031dfb425e963b0ae7bfbf33">idigi_class_t</a> <span class="keyword">const</span> class_id, <a class="code" href="unionidigi__request__t.html">idigi_request_t</a> <span class="keyword">const</span> request_id
                              <span class="keywordtype">void</span> * <span class="keyword">const</span> request_data, <span class="keywordtype">size_t</span> <span class="keyword">const</span> request_length,
                              <span class="keywordtype">void</span> * response_data, <span class="keywordtype">size_t</span> * <span class="keyword">const</span> response_length)
 {

     <span class="keywordflow">if</span> (class_id = <a class="code" href="group__idigi__class__t.html#gga3d9da89a031dfb425e963b0ae7bfbf33a574cbaa906514d12d8a931d0ca382b51">idigi_class_network</a> &amp;&amp; request_id.network_request == <a class="code" href="group__idigi__network__request__t.html#gga6772dc9d110c19be6fa789f45828f70ea6384f605f8659f9755e0e05532706b99">idigi_network_close</a>)
     {
          <a class="code" href="group__idigi__network__handle__t.html#ga56cc37674d1d16993665a185cbb3d6ac">idigi_network_handle_t</a> * <span class="keyword">const</span> fd = (<a class="code" href="group__idigi__network__handle__t.html#ga56cc37674d1d16993665a185cbb3d6ac">idigi_network_handle_t</a> *)request_data;
          <span class="keywordflow">if</span> (close(*fd) &lt; 0)
          {
              perror(<span class="stringliteral">&quot;close() failed&quot;</span>);
          }
          <span class="keywordflow">return</span> <a class="code" href="group__idigi__callback__status__t.html#ggaada37d2b3520ae3522ccf0ed368f458dabda2f93a62bdf6914f7c2f1736b59e94">idigi_callback_continue</a>;
     }
 }
</pre></div><h2><a class="anchor" id="disconnected"></a>
Connection disconnected</h2>
<p>Callback is called when the iDigi server has terminated the connection. IIK calls this callback to notify that the iDigi server has disconnected the connection.</p>
 
 <table class="apitable">
 <tr> <th colspan="2" class="title">Arguments</th> </tr> 
 <tr><th class="subtitle">Name</th> <th class="subtitle">Description</th></tr>
 <tr>
 <th>class_id</th>
 <td> <a class="el" href="group__idigi__class__t.html#gga3d9da89a031dfb425e963b0ae7bfbf33a574cbaa906514d12d8a931d0ca382b51">idigi_class_network</a>  </td>
 </tr>
 <tr>
 <th>request_id</th>
 <td> <a class="el" href="group__idigi__network__request__t.html#gga6772dc9d110c19be6fa789f45828f70ea74912258bdb6975d16b1db4c31643307">idigi_network_disconnected</a>  </td>
 </tr>
 <tr>
 <th>request_data</th>
 <td>N/A</td>
 </tr>
 <tr>
 <th>request_length</th>
 <td> N/A</td>
 </tr>
 <tr>
 <th>response_data</th>
 <td> N/A </td>
 </tr>
 <tr>
 <th>response_length</th>
 <td>N/A</td>
 </tr>
 <tr> <th colspan="2" class="title">Return Values</th> </tr> 
 <tr><th class="subtitle">Values</th> <th class="subtitle">Description</th></tr>
 <tr>
 <td> <a class="el" href="group__idigi__callback__status__t.html#ggaada37d2b3520ae3522ccf0ed368f458dabda2f93a62bdf6914f7c2f1736b59e94">idigi_callback_continue</a>  </td>
 <td>IIK will continue and establish the connection again</td>
 </tr>
 <tr>
 <td> <a class="el" href="group__idigi__callback__status__t.html#ggaada37d2b3520ae3522ccf0ed368f458da77b6cf49c4a1cb6d18489ec31112d7fa">idigi_callback_abort</a>  </td>
 <td>IIK will abort and return idigi_disconnected error status</td>
 </tr>
 </table>
 <p>Example:</p>
<div class="fragment"><pre class="fragment"> <a class="code" href="group__idigi__callback__status__t.html#gaada37d2b3520ae3522ccf0ed368f458d">idigi_callback_status_t</a> idigi_callback(<a class="code" href="group__idigi__class__t.html#ga3d9da89a031dfb425e963b0ae7bfbf33">idigi_class_t</a> <span class="keyword">const</span> class_id, <a class="code" href="unionidigi__request__t.html">idigi_request_t</a> <span class="keyword">const</span> request_id
                              <span class="keywordtype">void</span> * <span class="keyword">const</span> request_data, <span class="keywordtype">size_t</span> <span class="keyword">const</span> request_length,
                              <span class="keywordtype">void</span> * response_data, <span class="keywordtype">size_t</span> * <span class="keyword">const</span> response_length)
 {

     <span class="keywordflow">if</span> (class_id = <a class="code" href="group__idigi__class__t.html#gga3d9da89a031dfb425e963b0ae7bfbf33a574cbaa906514d12d8a931d0ca382b51">idigi_class_network</a> &amp;&amp; request_id.network_request == <a class="code" href="group__idigi__network__request__t.html#gga6772dc9d110c19be6fa789f45828f70ea74912258bdb6975d16b1db4c31643307">idigi_network_disconnected</a>)
     {
          <span class="comment">/* we&#39;ve been disconnected. Just return continue to reconnect */</span>
          <span class="keywordflow">return</span> <a class="code" href="group__idigi__callback__status__t.html#ggaada37d2b3520ae3522ccf0ed368f458dabda2f93a62bdf6914f7c2f1736b59e94">idigi_callback_continue</a>;
     }
 }
</pre></div><h2><a class="anchor" id="reboot"></a>
Reboot</h2>
<p>Callback is called when the iDigi server requests that the device reboots. The device should reboot and this callback should not return.</p>
 
 <table class="apitable">
 <tr> <th colspan="2" class="title">Arguments</th> </tr> 
 <tr><th class="subtitle">Name</th> <th class="subtitle">Description</th></tr>
 <tr>
 <th>class_id</th>
 <td> <a class="el" href="group__idigi__class__t.html#gga3d9da89a031dfb425e963b0ae7bfbf33a574cbaa906514d12d8a931d0ca382b51">idigi_class_network</a>  </td>
 </tr>
 <tr>
 <th>request_id</th>
 <td> <a class="el" href="group__idigi__network__request__t.html#gga6772dc9d110c19be6fa789f45828f70eadaf04c8a25760718c4e45c2e413848c3">idigi_network_reboot</a>  </td>
 </tr>
 <tr>
 <th>request_data</th>
 <td> N/A </td>
 </tr>
 <tr>
 <th>request_length</th>
 <td> N/A.</td>
 </tr>
 <tr>
 <th>response_data</th>
 <td> N/A </td>
 </tr>
 <tr>
 <th>response_length</th>
 <td>N/A</td>
 </tr>
 <tr> <th colspan="2" class="title">Return Values</th> </tr> 
 <tr><th class="subtitle">Values</th> <th class="subtitle">Description</th></tr>
 <tr>
 <td>No return</td>
 <td>none</td>
 </tr>
 </table>
 <p>Example:</p>
<div class="fragment"><pre class="fragment"> <a class="code" href="group__idigi__callback__status__t.html#gaada37d2b3520ae3522ccf0ed368f458d">idigi_callback_status_t</a> idigi_callback(<a class="code" href="group__idigi__class__t.html#ga3d9da89a031dfb425e963b0ae7bfbf33">idigi_class_t</a> <span class="keyword">const</span> class_id, <a class="code" href="unionidigi__request__t.html">idigi_request_t</a> <span class="keyword">const</span> request_id
                              <span class="keywordtype">void</span> * <span class="keyword">const</span> request_data, <span class="keywordtype">size_t</span> <span class="keyword">const</span> request_length,
                              <span class="keywordtype">void</span> * response_data, <span class="keywordtype">size_t</span> * <span class="keyword">const</span> response_length)
 {

     <span class="keywordflow">if</span> (class_id = <a class="code" href="group__idigi__class__t.html#gga3d9da89a031dfb425e963b0ae7bfbf33a574cbaa906514d12d8a931d0ca382b51">idigi_class_network</a> &amp;&amp; request_id.network_request == <a class="code" href="group__idigi__network__request__t.html#gga6772dc9d110c19be6fa789f45828f70eadaf04c8a25760718c4e45c2e413848c3">idigi_network_reboot</a>)
     {
          server_reboot();
          <span class="keywordflow">return</span> <a class="code" href="group__idigi__callback__status__t.html#ggaada37d2b3520ae3522ccf0ed368f458dabda2f93a62bdf6914f7c2f1736b59e94">idigi_callback_continue</a>;
     }
 }
</pre></div> </div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer">
<center>
<a href="http://www.idigi.com">
</a> Copyright 1996-2011 Digi International Inc. All rights reserved.
</center>
</address>

</body>
</html>
